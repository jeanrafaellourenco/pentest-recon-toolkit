#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# pip3 install requests, urllib3, python-whois
import dns.resolver 
import requests
import urllib3
import whois
import sys


if len(sys.argv) < 2:
    print('./domainrecon.py https://example.com')
    exit(1)
    
url = sys.argv[1]
url = url.replace("https://","")
url = url.replace("https://www.","")
url = url.replace("http://","")
url = url.replace("http://www.","")
url = url.replace("/","")

# whois
domain = url
query = whois.whois(f'{domain}')


def whois_br():
    print(f"Domain: {query['domain_name']}")
    print(f"Owner: {query['registrant_name']}")
    print(f"E-mail: {query['email']}")
    print(f"CPF/CNPJ: {query['registrant_id']}")
    print(f"Creation Date: {query['creation_date']}")
    print(f"Expiration Date: {query['expiration_date']}")
    print(f"Status: {query['status']}")


def whois_not_br():
    print(f"Domain: {query['domain_name']}")
    print(f"Owner: {query['registrar']}")
    print(f"Name: {query['name']}")
    print(f"ORG: {query['org']}")
    print(f"Address: {query['address']}")
    print(f"City: {query['city']}")
    print(f"State: {query['state']}")
    print(f"Country: {query['country']}")
    print(f"E-mail: {query['emails']}")
    print(f"Creation Date: {query['creation_date']}")
    print(f"Expiration Date: {query['expiration_date']}")


if query.registrant_name:
    whois_br()
else:
    whois_not_br()
print(f"===============================================")

# nslookup A register
result = dns.resolver.resolve(url, 'A') 
for val in result: 
    print('A Record : ', val.to_text())
print(f"===============================================")

# url header
url = sys.argv[1]
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning) # desativando erros de certificado ssl
header = {"User-Agent": "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:94.0) Gecko/20100101 Firefox/94.0"}
response = requests.head(url, headers = header, verify=False)
print(f"Url: {url}")
print(f"Status: {response.status_code}")
print(f"====================HEADERS====================")
for x,y in response.headers.items():
    print(x,y)
print(f"===============================================")
